[gcode_macro PARK_BED]
description: Park bed to prevent sagging
gcode:
    {% set z_max = printer.toolhead.axis_maximum.z %}   
    {% set z_pos = printer.toolhead.position.z %}
    {% set z = params.Z|default(z_max - 0.2)|float %}
    
    SAVE_GCODE_STATE NAME=park_bed
    G90
    {% if z_pos < z_max %}
      G1 Z {z} F1000
    {% endif %}
        
    RESTORE_GCODE_STATE NAME=park_bed

